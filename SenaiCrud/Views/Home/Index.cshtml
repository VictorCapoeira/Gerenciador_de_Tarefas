@model IEnumerable<SenaiCrud.Models.Tables.Tarefas>

<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="~/css/site.css" />
</head>

<div class="agenda-container">
    <h1>Agenda de Tarefas</h1>

    <!-- Formulário para adicionar nova tarefa -->
    <form asp-action="Create" method="post" class="nova-tarefa-form">
        <input type="text" name="Titulo" placeholder="Título" required maxlength="255" />
        <textarea name="Descricao" placeholder="Descrição" rows="1"></textarea>
        <button type="submit">Adicionar</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>Título</th>
                <th>Descrição</th>
                <th>Criada em</th>
                <th>Status</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
        @{
            var editId = ViewBag.EditId as int?;
        }
        @if (Model != null && Model.Any())
        {
            foreach (var tarefa in Model)
            {
                if (editId == tarefa.Id)
                {
                    <tr>
                        <form asp-action="Edit" method="post" class="d-flex align-items-center">
                            <input type="hidden" name="id" value="@tarefa.Id" />
                            <td class="p-1 align-middle">
                                <input type="text" name="Titulo" value="@tarefa.Titulo" maxlength="255" required class="form-control form-control-sm" />
                            </td>
                            <td class="p-1 align-middle">
                                <textarea name="Descricao" rows="1" class="form-control form-control-sm">@tarefa.Descricao</textarea>
                            </td>
                            <td class="p-1 align-middle" style="min-width:110px;">
                                @tarefa.DataCriacao.ToString("dd/MM/yyyy")
                            </td>
                            <td class="p-1 align-middle text-center">
                                <input type="checkbox" name="Concluida" value="true" @(tarefa.Concluida ? "checked" : "") class="form-check-input" style="margin-top:0.2em;" />
                                <span class="ms-1">@((tarefa.Concluida) ? "Concluída" : "Pendente")</span>
                            </td>
                            <td class="actions p-1 align-middle">
                                <button type="submit" title="Salvar" class="btn btn-link p-0 m-0" style="color:#28a745;">
                                    <i class="fa-solid fa-floppy-disk"></i>
                                </button>
                                <a asp-action="Index" class="btn btn-link p-0 m-0" title="Cancelar" style="color:#dc3545;">
                                    <i class="fa-solid fa-xmark"></i>
                                </a>
                            </td>
                        </form>
                    </tr>
                }
                else
                {
                    <tr>
                        <td class="@(tarefa.Concluida ? "concluida" : "")">@tarefa.Titulo</td>
                        <td class="@(tarefa.Concluida ? "concluida" : "")">@tarefa.Descricao</td>
                        <td>@tarefa.DataCriacao.ToString("dd/MM/yyyy")</td>
                        <td>
                            @if (tarefa.Concluida)
                            {
                                <span style="color: #28a745;">Concluída</span>
                            }
                            else
                            {
                                <span style="color: #dc3545;">Pendente</span>
                            }
                        </td>
                        <td class="actions">
                            @if (!tarefa.Concluida)
                            {
                                <form asp-action="Concluir" asp-route-id="@tarefa.Id" method="post" style="display:inline;">
                                    <button title="Marcar como concluída">&#10003;</button>
                                </form>
                            }
                            <a asp-action="Index" asp-route-editId="@tarefa.Id" title="Editar"><i class="fa-solid fa-pen-to-square"></i></a>
                            <form asp-action="Delete" asp-route-id="@tarefa.Id" method="post" style="display:inline;" onsubmit="return confirm('Deseja excluir esta tarefa?');">
                                <button title="Excluir" style="color:#dc3545;"><i class="fa-solid fa-trash"></i></button>
                            </form>
                        </td>
                    </tr>
                }
            }
        }
        else
        {
            <tr>
                <td colspan="5" style="text-align:center;color:#888;">Nenhuma tarefa cadastrada.</td>
            </tr>
        }
        </tbody>
    </table>
</div>
